# Keycloak OAuth2/OIDC Provider
# This file is generated by JHipster and should be used for local development
#
# Start with: docker compose -f docker/keycloak.yml up -d
# Stop with: docker compose -f docker/keycloak.yml down
#
# Default credentials:
# - Admin console: http://localhost:9080 (admin/admin)
# - Realm: jhipster
# - Client: web_app (secret: web_app)
# - Test users: admin/admin, user/user

services:
  keycloak:
    image: quay.io/keycloak/keycloak:23.0
    command: ['start-dev', '--import-realm']
    volumes:
      - ./realm-config:/opt/keycloak/data/import
    environment:
      - KEYCLOAK_ADMIN=admin
      - KEYCLOAK_ADMIN_PASSWORD=admin
      - KC_HTTP_PORT=9080
      - KC_DB=dev-file
    ports:
      - '9080:9080'
    healthcheck:
      test: ['CMD-SHELL', 'exec 3<>/dev/tcp/localhost/9080 && echo -e "GET /realms/jhipster HTTP/1.1\r\nHost: localhost\r\nConnection: close\r\n\r\n" >&3 && cat <&3 | grep -q "200 OK"']
      interval: 10s
      timeout: 5s
      retries: 20
      start_period: 40s
