# Consul service discovery and configuration management
# This configuration is intended for development purpose, it's **your** responsibility to harden it for production
name: <%= baseName.toLowerCase() %>-consul
services:
  consul:
    image: hashicorp/consul:1.15
    ports:
      - 127.0.0.1:8300:8300  # Raft consensus
      - 127.0.0.1:8500:8500  # HTTP API & UI
      - 127.0.0.1:8600:8600  # DNS
    command: consul agent -dev -ui -client 0.0.0.0 -log-level=INFO
    environment:
      - CONSUL_BIND_INTERFACE=eth0
    healthcheck:
      test: ['CMD', 'consul', 'members']
      interval: 5s
      timeout: 5s
      retries: 10
    labels:
      org.springframework.boot.ignore: true

  consul-config-loader:
    image: jhipster/consul-config-loader:v0.4.1
    volumes:
      - ./central-server-config:/config
    environment:
      - INIT_SLEEP_SECONDS=5
      - CONSUL_URL=consul
      - CONSUL_PORT=8500
    depends_on:
      consul:
        condition: service_healthy
    labels:
      org.springframework.boot.ignore: true
